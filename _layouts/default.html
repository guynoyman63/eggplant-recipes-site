<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  {% include head.html %}
  <style>
    /* ×§×•× ×˜×™×™× ×¨ ×œ×›×¤×ª×•×¨×™× â€“ ××•×¦×‘ ×‘×¤×™× ×” ×”×©×××œ×™×ª ×”×ª×—×ª×•× ×” */
    .fixed-buttons {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: flex;
      gap: 10px; /* ×¨×•×•×— ×§×˜×Ÿ ×‘×™×Ÿ ×”×›×¤×ª×•×¨×™× */
      z-index: 1000;
    }
    /* ×¡×’× ×•×Ÿ ××—×™×“ ×œ×©× ×™ ×”×›×¤×ª×•×¨×™× â€“ ××•×•×“× ×©××™×Ÿ ×”×©×¤×¢×•×ª ×—×™×¦×•× ×™×•×ª ××”Ö¾SCSS */
    .fixed-buttons .accessibility-button,
    .fixed-buttons .tts-button {
      background-color: #000;
      color: #fff;
      padding: 10px 15px;
      font-size: 1.2rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
      /* ××‘×˜×œ×™× ×”×’×“×¨×•×ª ××™×§×•× ×©×¢×œ×•×œ×•×ª ×œ×”×’×™×¢ ×××§×•××•×ª ××—×¨×™× */
      position: static !important;
    }
    .fixed-buttons .accessibility-button:hover,
    .fixed-buttons .tts-button:hover {
      background-color: #444;
    }
    /* ×”×ª×××” ×œ××•×‘×™×™×œ */
    @media (max-width: 768px) {
      .fixed-buttons {
        bottom: 15px;
        left: 15px;
        gap: 8px;
      }
      .fixed-buttons .accessibility-button,
      .fixed-buttons .tts-button {
        font-size: 1rem;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body class="layout-body">
  <header class="site-header">
    {% include header.html %}
  </header>

  <main class="main-content">
    {{ content }}
  </main>

  <footer class="site-footer">
    {% include footer.html %}
  </footer>

  <!-- ×§×•× ×˜×™×™× ×¨ ×œ×›×¤×ª×•×¨×™× ×”×§×‘×•×¢×™×: ×›×¤×ª×•×¨ × ×’×™×©×•×ª ×•×›×¤×ª×•×¨ ×“×™×‘×•×¨ ×”×˜×§×¡×˜ -->
  <div class="fixed-buttons">
    <button id="accessibility-btn" onclick="toggleAccessibility()" class="accessibility-button">
      ğŸ¦¾ × ×’×™×©×•×ª
    </button>
    <button id="tts-btn" onclick="toggleSpeechMode()" class="tts-button">
      ğŸ”Š ×“×™×‘×•×¨ ×”×˜×§×¡×˜
    </button>
  </div>

  <script>
    // ×‘×™×˜×•×œ ×“×™×‘×•×¨ ×‘×¢×ª ××¢×‘×¨ ×“×£ ×›×“×™ ×œ×× ×•×¢ ×§×¨×™××” ×××©×™×›×”
    window.onbeforeunload = function() {
      window.speechSynthesis.cancel();
    };

    // Toggle ××¦×‘ × ×’×™×©×•×ª â€“ ×œ×œ× ×©×™× ×•×™ ×›××Ÿ (×›×¤×™ ×©×”×™×™×ª× ××©×ª××©×™× ×‘×• ×›×‘×¨)
    function toggleAccessibility() {
      document.body.classList.toggle("high-contrast");
      document.body.classList.toggle("large-text");
      localStorage.setItem("highContrast", document.body.classList.contains("high-contrast"));
      localStorage.setItem("largeText", document.body.classList.contains("large-text"));
    }

    // Toggle ×œ××¦×‘ ×“×™×‘×•×¨ (Speech Mode)
    function toggleSpeechMode() {
      if (localStorage.getItem("speechModeActive") === "true") {
        // ×›×™×‘×•×™ ××¦×‘ ×“×™×‘×•×¨
        localStorage.setItem("speechModeActive", "false");
        window.speechSynthesis.cancel();
      } else {
        // ×”×¤×¢×œ×ª ××¦×‘ ×“×™×‘×•×¨ ×•×”×¤×¢×œ×ª ×§×¨×™××”
        localStorage.setItem("speechModeActive", "true");
        speakPageText();
      }
    }

    // ×¤×•× ×§×¦×™×” ×œ×§×¨×™××ª ×˜×§×¡×˜ ××”×“×£
    function speakPageText() {
      // ×× ××¦×‘ ×“×™×‘×•×¨ ×œ× ×¤×¢×™×œ â€“ ××™×Ÿ ×œ×”×ª×—×™×œ ×§×¨×™××”
      if (localStorage.getItem("speechModeActive") !== "true") return;
      // ×× ×›×‘×¨ ××ª×‘×¦×¢ ×“×™×‘×•×¨, ×‘×™×˜×•×œ ×•×”×¤×¢×œ×ª ×§×¨×™××” ××—×“×©
      if (window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
      }

      let fullText = "";
      // ×× ××“×•×‘×¨ ×‘×“×£ ××ª×›×•×Ÿ (×›×ª×•×‘×ª ×›×•×œ×œ×ª "/recipes/")
      if (window.location.pathname.indexOf('/recipes/') > -1) {
        const articleElem = document.querySelector('article.recipe-container');
        if (articleElem) {
          // ×× ×–×” ×”×¤×¢× ×”×¨××©×•× ×” ×‘×“×£ ×–×” â€“ ×§×¨× ××ª ×›×œ ×”×ª×•×›×Ÿ (×›×•×œ×œ ×”Ö¾header ×©×œ ×”××ª×›×•×Ÿ)
          if (!sessionStorage.getItem("headerRead")) {
            fullText = articleElem.innerText;
            sessionStorage.setItem("headerRead", "true");
          } else {
            // ×‘×¤×¢××™× ×”×‘××•×ª â€“ × ×¡×” ×œ×”×¡×™×¨ ××ª ×”×—×œ×§ ×©×œ .recipe-header ××”×¢×•×ª×§
            let cloneArticle = articleElem.cloneNode(true);
            let headerElem = cloneArticle.querySelector(".recipe-header");
            if (headerElem) headerElem.remove();
            fullText = cloneArticle.innerText;
          }
        }
      } else {
        // ×‘×“×¤×™× ××—×¨×™× â€“ ×× ×œ× × ×§×¨× header ×›×‘×¨, ×§×¨× ××ª ×›×œ ×”×“×£, ××—×¨×ª ×¨×§ ××ª main
        if (!sessionStorage.getItem("headerRead")) {
          fullText = document.body.innerText;
          sessionStorage.setItem("headerRead", "true");
        } else {
          const mainEl = document.querySelector("main.main-content");
          fullText = mainEl ? mainEl.innerText : document.body.innerText;
        }
      }
      
      if (!fullText) return;
      const utterance = new SpeechSynthesisUtterance(fullText);
      utterance.lang = "he-IL";
      window.speechSynthesis.speak(utterance);
    }

    // ×‘×¢×ª ×˜×¢×™× ×ª ×”×“×£ â€“ ×©×—×–×•×¨ ×”×’×“×¨×•×ª × ×’×™×©×•×ª ×•×‘×“×™×§×” ×©×œ ××¦×‘ ×“×™×‘×•×¨:
    window.onload = function() {
      if (localStorage.getItem("highContrast") === "true") {
        document.body.classList.add("high-contrast");
      }
      if (localStorage.getItem("largeText") === "true") {
        document.body.classList.add("large-text");
      }
      // ×× ××¦×‘ ×“×™×‘×•×¨ ×¤×¢×™×œ, ×‘×™×˜×•×œ ×§×¨×™××” ×§×•×“××ª ×•×”×¤×¢×œ×ª ×§×¨×™××” ×‘×“×£ ×”×—×“×©
      if (localStorage.getItem("speechModeActive") === "true") {
        window.speechSynthesis.cancel();
        speakPageText();
      }
    };
  </script>
</body>
</html>
